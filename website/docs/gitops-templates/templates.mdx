---
title: Using templates
sidebar_position: 3
hide_title: true
---

import TierLabel from "../_components/TierLabel";

# Using templates <TierLabel tiers="enterprise" />

## Orgnizing Templates

Declare the type of a template by using the `weave.works/template-type` label. The value of the label is the name of the template type. The template type is used to group templates in the UI.

Recommended template types:
- `application` - for application templates
- `cluster` - for cluster templates
- `terraform` - for Terraform templates

## Enabling/Disabling Template Components

Enable or disable rendering of certain component sections in a template with the use of annotations. This can be done by using the `templates.weave.works/COMPONENT-enabled` annotation with a boolean value.

Supported components:
- `profiles`
- `kustomizations`
- `credentials`

Example:
```
annotations:
  templates.weave.works/profiles-enabled: true
  templates.weave.works/kustomizations-enabled: true
  templates.weave.works/credentials-enabled: true
```

## Rendering Templates

Declare the render type indicating the templating language to be used to render the template by using the `renderType` spec.

Supported templating languages:
- `envsubst` - uses [envsubst](https://github.com/a8m/envsubst) for rendering 
- `templating` - uses text/templating for rendering supporting the following [functions](http://masterminds.github.io/sprig/):
  - String Functions: *trim*, *wrap*, *randAlpha*, *plural*
    - String List Functions: *splitList*, *sortAlpha*
  - Integer Math Functions: *add*, *max*, *mul*
    - Integer Slice Functions: *until*, untilStep
  - Float Math Functions: *addf*, *maxf*, *mulf*
  - Date Functions: *now*, *date*
  - Defaults Functions: *default*, *empty*, *coalesce*, *fromJson*, *toJson*, *toPrettyJson*, *toRawJson*, ternary
  - Encoding Functions: *b64enc*, *b64dec*
  - Lists and List Functions: *list*, *first*, *uniq*
  - Dictionaries and Dict Functions: *get*, *set*, *dict*, *hasKey*, *pluck*, *dig*, *deepCopy*
  - Type Conversion Functions: *atoi*, *int64*, *toString*
  - Flow Control Functions: *fail*
  - Advanced Functions
    - UUID Functions: *uuidv4*
    - Version Comparison Functions: *semver*, semverCompare
    - Reflection: *typeOf*, *kindIs*, *typeIsLike*


## How to: Add a CAPI Template

CAPI Templates objects need to be wrapped with the `CAPITemplate` custom resource and then loaded into the management cluster.

```yaml
apiVersion: capi.weave.works/v1alpha1
kind: CAPITemplate
metadata:
  name: cluster-template-development
  labels:
    weave.works/template-type: cluster
spec:
  description: This is the std. CAPD template
  renderType: templating
  params:
    - name: CLUSTER_NAME
      description: This is used for the cluster naming.
  resourcetemplates:
    # Template objects go here
    - apiVersion: cluster.x-k8s.io/v1alpha3
      kind: Cluster
      metadata:
        name: "${CLUSTER_NAME}"
```

### Parameter metadata - `spec.params`

You can provide additional metadata about the parameters to the templates in the `spec.params` section.

- `name`: The variable name within the resource templates
- `descripton`: Description of the parameter. This will be rendered in the UI and CLI
- `options`: The list of possible values this parameter can be set to.
- `required` -  Whether the paramter must contain a non-empty value
- `default` - Default value of the parameter 

Sample:
```
spec:
  params:
    - name: PARAM_NAME_1
      description: DESC_1
      options: [OPTION_1,OPTION_2]
      default: OPTION_1
    - name: PARAM_NAME_2
      description: DESC_1
      required: true
      default: DEFAULT_2
```


### Loading the template into the cluster

Load templates into the cluster by adding them to your flux managed git repository or by using apply directly with
`kubectl apply -f capi-template.yaml`

Weave GitOps will search for templates in the `default` namespace. This can be changed by configuring the `config.capi.namespace` value in the helm chart.

## Full CAPD docker template example

This example works with the CAPD provider, see [Cluster API Providers](../cluster-management/cluster-api-providers.mdx).

import CodeBlock from "@theme/CodeBlock";
import CapdTemplate from "!!raw-loader!../assets/templates/capd-template.yaml";

<CodeBlock
  title="clusters/management/capi/templates/capd-template.yaml"
  className="language-yaml"
>
  {CapdTemplate}
</CodeBlock>
